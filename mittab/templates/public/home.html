{% extends "base/__wide.html" %}
{% load tags %}

{% block title %}{% tournament_name %} â€¢ Public Hub{% endblock %}

{% block banner %}{% endblock %}

{% block content %}
<div class="col-12 d-flex justify-content-center public-home-wrapper">
  <div class="public-home">
    <div class="grid">
      <aside class="sidebar">
        <div class="public-sidebar-card status">
          <h3 class="title">{% tournament_name %}</h3>
          <div class="content">
            <div id="tournament-status">
              <!-- Status will be dynamically updated by JavaScript -->
              <div class="status-icon" aria-hidden="true">
                <i class="fas fa-clipboard-check"></i>
              </div>
              <div class="status-text">
                <div class="status-primary" id="status-primary">Loading...</div>
                <div class="status-secondary" id="status-secondary"></div>
              </div>
            </div>
            
            <div class="divider"></div>
            
            <div class="item">
              <div class="icon">
                <i class="fas fa-info-circle"></i>
              </div>
              <div class="text">
                <strong>Tournament Updates</strong>
                <p>Check back regularly for updated pairings, results, and standings throughout the tournament.</p>
              </div>
            </div>
            
            <div class="item">
              <div class="icon warning">
                <i class="fas fa-gavel"></i>
              </div>
              <div class="text">
                <strong>For Judges</strong>
                <p>Use your ballot code to submit results electronically via the E-Ballot link.</p>
              </div>
            </div>
            
            <div class="item">
              <div class="icon success">
                <i class="fas fa-users"></i>
              </div>
              <div class="text">
                <strong>For Teams</strong>
                <p>View your matchups in Released Pairings and track your progress in Team Rankings.</p>
              </div>
            </div>
            
            <div class="item">
              <div class="icon info">
                <i class="fas fa-sign-in-alt"></i>
              </div>
              <div class="text">
                <strong>Staff Login</strong>
                <p><a href="{% url 'tab_login' %}">Login here</a> if you're tournament staff to access admin features.</p>
              </div>
            </div>
          </div>
        </div>
      </aside>
      
      <aside class="links" aria-labelledby="public-home-quick-links">
        <header class="header mobile-only">
          <span class="label accent">Tournament</span>
          <h1 class="title" id="public-home-quick-links">{% tournament_name %}</h1>
        </header>
        <p class="lede">
          Live updates for pairings, ballots, and standings. Tab staff post here the moment information is released.
        </p>

        <nav class="public-links" aria-label="Quick links">
          <a class="tile primary" href="{% url 'pretty_pair' %}">
            <span class="icon"><i class="fas fa-th-large"></i></span>
            <span class="body">
              <span class="title">Released Pairings</span>
              <span class="subtitle">Latest rounds and room assignments.</span>
            </span>
            <span class="chevron"><i class="fas fa-arrow-right"></i></span>
          </a>
          <a class="tile warning" href="{% url 'missing_ballots' %}">
            <span class="icon"><i class="fas fa-clipboard-check"></i></span>
            <span class="body">
              <span class="title">Missing Ballots</span>
              <span class="subtitle">Outstanding ballots that need attention.</span>
            </span>
            <span class="chevron"><i class="fas fa-arrow-right"></i></span>
          </a>
          <a class="tile success" href="{% url 'rank_teams_public' %}">
            <span class="icon"><i class="fas fa-trophy"></i></span>
            <span class="body">
              <span class="title">Team Rankings</span>
              <span class="subtitle">Current standings and performance.</span>
            </span>
            <span class="chevron"><i class="fas fa-arrow-right"></i></span>
          </a>
          <a class="tile info" href="{% url 'e_ballot_search' %}">
            <span class="icon"><i class="fas fa-tablet-alt"></i></span>
            <span class="body">
              <span class="title">Submit E-Ballot</span>
              <span class="subtitle">Judges enter ballot codes to file results.</span>
            </span>
            <span class="chevron"><i class="fas fa-arrow-right"></i></span>
          </a>
          <a class="tile success" href="{% url 'public_judges' %}">
            <span class="icon"><i class="fas fa-balance-scale"></i></span>
            <span class="body">
              <span class="title">Judge List</span>
              <span class="subtitle">Roster and check-in status.</span>
            </span>
            <span class="chevron"><i class="fas fa-arrow-right"></i></span>
          </a>
          <a class="tile neutral" href="{% url 'public_teams' %}">
            <span class="icon"><i class="fas fa-users"></i></span>
            <span class="body">
              <span class="title">Team List</span>
              <span class="subtitle">Registered teams and schools.</span>
            </span>
            <span class="chevron"><i class="fas fa-arrow-right"></i></span>
          </a>
        </nav>
      </aside>
    </div>
  </div>
</div>

<script>
(function() {
  const curRound = {{ cur_round }};
  const totRounds = {{ tot_rounds }};
  const pairingReleased = {{ pairing_released|yesno:"true,false" }};
  const missingBallots = {{ missing_ballots_count }};
  const inOutrounds = {{ in_outrounds|yesno:"true,false" }};
  const currentOutroundLabel = "{{ current_outround_label|escapejs }}";

  const statusShell = document.querySelector('.status-icon');
  const statusPrimary = document.getElementById('status-primary');
  const statusSecondary = document.getElementById('status-secondary');

  if (!statusShell || !statusPrimary || !statusSecondary) {
    return;
  }

  function setStatusState() {
    statusShell.className = 'status-icon';
  }

  function updateStatus() {
    // During outrounds
    if (inOutrounds && currentOutroundLabel) {
      if (pairingReleased) {
        setStatusState();
        statusPrimary.textContent = currentOutroundLabel;
        if (missingBallots > 0) {
          statusSecondary.textContent = `${missingBallots} ballot${missingBallots !== 1 ? 's' : ''} missing`;
        } else {
          statusSecondary.textContent = 'All ballots in';
        }
      } else {
        setStatusState();
        statusPrimary.textContent = currentOutroundLabel;
        statusSecondary.textContent = 'Pairing in progress';
      }
      return;
    }
    
    // During inrounds
    if (curRound > 1 && curRound <= totRounds + 1) {
      const displayRound = curRound - 1;
      if (pairingReleased) {
        setStatusState();
        statusPrimary.textContent = `Round ${displayRound}`;
        if (missingBallots > 0) {
          statusSecondary.textContent = `${missingBallots} ballot${missingBallots !== 1 ? 's' : ''} missing`;
        } else {
          statusSecondary.textContent = 'All ballots in';
        }
      } else {
        setStatusState();
        statusPrimary.textContent = `Round ${displayRound}`;
        statusSecondary.textContent = 'Pairing in progress';
      }
      return;
    }
    
    // Default state
    setStatusState();
    statusPrimary.textContent = 'Tournament';
    statusSecondary.textContent = 'Check back for updates';
  }

  // Update immediately
  updateStatus();
  
  // Update every second for countdown
  setInterval(updateStatus, 1000);
})();
</script>
{% endblock %}
