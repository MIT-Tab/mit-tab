{% extends "base/__normal.html" %}
{% load bootstrap4 %}

{% block title %}{{ title }}{% endblock %}

{% block banner %}{{ title }}{% endblock %}

{% load tags %}

{% block content %}
<div class="row no-gutters w-100">
    <!-- Sidebar -->
    <div class="col-auto border-right" style="width: 280px;">
        <div class="p-3">
            <!-- Create/Upload Backup -->
            <div class="card shadow-sm mb-3">
                <div class="card-body p-3">
                    <h6 class="text-uppercase text-muted small font-weight-bold mb-3">Backup Actions</h6>
                    
                    <!-- Tabs -->
                    <ul class="nav nav-pills nav-fill mb-3" id="backup-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active py-1 px-2 small" id="create-tab" data-toggle="pill" href="#create-form" role="tab">Create</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-1 px-2 small" id="upload-tab" data-toggle="pill" href="#upload-form" role="tab">Upload</a>
                        </li>
                    </ul>
                    
                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Create Form -->
                        <div class="tab-pane fade show active" id="create-form" role="tabpanel">
                            <form method="post" action="{% url 'manual_backup' %}">
                                {% csrf_token %}
                                <div class="form-group">
                                    <input type="text" name="backup_name" id="backup_name" class="form-control form-control-sm" pattern="[^_]*" title="Underscores are not allowed." placeholder="Backup name" required>
                                </div>
                                <div class="custom-control custom-checkbox mb-3">
                                    <input type="checkbox" name="include_scratches" id="include_scratches" class="custom-control-input" checked>
                                    <label class="custom-control-label small" for="include_scratches">Include scratches</label>
                                </div>
                                <button type="submit" class="btn btn-sm btn-primary btn-block">
                                    <i class="fas fa-save mr-1"></i>Create
                                </button>
                            </form>
                        </div>
                        
                        <!-- Upload Form -->
                        <div class="tab-pane fade" id="upload-form" role="tabpanel">
                            <form method="post" action="{% url 'upload_backup' %}" enctype="multipart/form-data">
                                {% csrf_token %}
                                <div class="custom-file mb-3">
                                    <input type="file" name="file" id="id_file" class="custom-file-input" required>
                                    <label class="custom-file-label small" for="id_file">Choose file</label>
                                </div>
                                <button type="submit" class="btn btn-sm btn-primary btn-block">
                                    <i class="fas fa-upload mr-1"></i>Upload
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Filters -->
            <div class="card shadow-sm">
                <div class="card-body p-3">
                    <h6 class="text-uppercase text-muted small font-weight-bold mb-3">Filters</h6>
                    <div class="form-group">
                        <label for="type-filter" class="small text-muted mb-1">Type</label>
                        <select id="type-filter" class="custom-select custom-select-sm">
                            <option value="">All</option>
                            {% for type in filter_types %}
                            <option value="{{ type }}">{{ type }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="round-filter" class="small text-muted mb-1">Round</label>
                        <select id="round-filter" class="custom-select custom-select-sm">
                            <option value="">All</option>
                            {% for round in filter_rounds %}
                            <option value="{{ round }}">{{ round }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group mb-0">
                        <label for="scratches-filter" class="small text-muted mb-1">Scratches</label>
                        <select id="scratches-filter" class="custom-select custom-select-sm">
                            <option value="">All</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                            <option value="Unknown">Unknown</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="col px-0">
        <div class="px-3 py-3">
            <!-- Backup Table -->
            <div id="backup-table" class="card rounded shadow-sm">
                <div class="table-responsive">
                    <table class="table table-striped table-sm mb-0">
                        <thead class="thead-light">
                            <tr>
                                {% for header in headers %}
                                <th class="sort border-top-0" data-sort="{{ header|lower }}" role="button" style="cursor: pointer;">
                                    {{ header }}
                                </th>
                                {% endfor %}
                            </tr>
                        </thead>
                        <tbody class="list">
                            {% for key, name, type, round, timestamp, scratches in backups %}
                            <tr data-type="{{ type }}" data-round="{{ round }}" data-scratches="{{ scratches }}">
                                <td class="name"><a href="/backup/{{ key }}">{{ name }}</a></td>
                                <td class="type text-muted">{{ type }}</td>
                                <td class="round text-muted">{{ round }}</td>
                                <td class="timestamp text-muted">{{ timestamp }}</td>
                                <td class="scratches text-muted">{{ scratches }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="{{ headers|length }}" class="text-center text-muted py-4">No backups found</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Update file input label when file is selected
document.getElementById('id_file').addEventListener('change', function(e) {
    var fileName = e.target.files[0] ? e.target.files[0].name : 'Choose file';
    var label = e.target.nextElementSibling;
    label.textContent = fileName;
});
</script>

{% endblock %}
