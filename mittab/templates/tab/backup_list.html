{% extends "base/__normal.html" %}
{% load bootstrap4 %}
{% load tags %}

{% block title %}{{ title }}{% endblock %}
{% block banner %}{{ title }}{% endblock %}

{% block content %}
<div class="row no-gutters w-100">
  <div class="col-auto border-right" style="width: 280px;">
    <div class="p-3">
      <div class="card shadow-sm mb-3">
        <div class="card-body p-3">
          <h6 class="text-uppercase text-muted small font-weight-bold mb-3">Backup Actions</h6>
          <ul class="nav nav-pills nav-fill mb-3" id="backup-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active py-1 px-2 small" id="create-tab" data-toggle="pill" href="#create-form" role="tab">Create</a>
            </li>
            <li class="nav-item">
              <a class="nav-link py-1 px-2 small" id="upload-tab" data-toggle="pill" href="#upload-form" role="tab">Upload</a>
            </li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane fade show active" id="create-form" role="tabpanel">
              <form method="post" action="{% url 'manual_backup' %}" class="mb-0">
                {% csrf_token %}
                {% bootstrap_field create_form.backup_name form_group_class="form-group mb-3" size="small" %}
                {% bootstrap_field create_form.include_scratches form_group_class="form-group mb-3" %}
                <button type="submit" class="btn btn-sm btn-primary btn-block">
                  <i class="fas fa-save mr-1"></i>Create
                </button>
              </form>
            </div>
            <div class="tab-pane fade" id="upload-form" role="tabpanel">
              <form method="post" action="{% url 'upload_backup' %}" enctype="multipart/form-data" class="mb-0">
                {% csrf_token %}
                {% bootstrap_field upload_form.file form_group_class="form-group mb-3" size="small" %}
                <button type="submit" class="btn btn-sm btn-primary btn-block">
                  <i class="fas fa-upload mr-1"></i>Upload
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="card shadow-sm">
        <div class="card-body p-3">
          <h6 class="text-uppercase text-muted small font-weight-bold mb-3">Filters</h6>
          {% for filter in filters %}
          <div class="form-group{% if forloop.last %} mb-0{% endif %}">
            <label for="{{ filter.id }}-filter" class="small text-muted mb-1">{{ filter.label }}</label>
            <select id="{{ filter.id }}-filter" class="custom-select custom-select-sm dropdown-filter" data-filter-key="{{ filter.id }}">
              <option value="">All</option>
              {% for option in filter.options %}
              <option value="{{ option }}">{{ option }}</option>
              {% endfor %}
            </select>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  <div class="col px-0">
    <div class="px-3 py-3">
      <div id="backup-table" class="card rounded shadow-sm">
        <div class="table-responsive">
          <table class="table table-striped table-sm mb-0">
            <thead class="thead-light">
              <tr>
                {% for header in headers %}
                <th class="border-top-0">
                  {{ header }}
                </th>
                {% endfor %}
              </tr>
            </thead>
            <tbody class="list">
              {% for key, name, type, round, timestamp, scratches in backups %}
              <tr class="filterable-row" data-type="{{ type }}" data-round="{{ round }}" data-scratches="{{ scratches }}">
                <td class="name"><a href="/backup/{{ key }}">{{ name }}</a></td>
                <td class="type text-muted">{{ type }}</td>
                <td class="round text-muted">{{ round }}</td>
                <td class="timestamp text-muted">{{ timestamp }}</td>
                <td class="scratches text-muted">{{ scratches }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="{{ headers|length }}" class="text-center text-muted py-4">No backups found</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
