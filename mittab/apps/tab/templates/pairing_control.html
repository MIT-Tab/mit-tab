{% extends "base_new.html" %}

{% block title %}Round Status{% endblock %}
{% url 'pair_round' as pair_round_url %}

{% block content %}
<div class="col">
  <div class="containter">
    <div class="row">
      <div class="col">
        <h3>
          Round Status for Round {{round_number}}:
          <small class="{% if valid_pairing %}text-success{% else %}text-danger{% endif %}">
            {% if valid_pairing %} Valid {% else %} Invalid {% endif %} pairing
          </small>
        </h3>

        {% if not valid_pairing %}
        <div class="alert alert-danger">
          <ul>
            {% for error in errors %}<li>{{ error }}</li>{% endfor %}
          </ul>
        </div>
        {% endif %}
      </div>
    </div> <!-- end heading row -->


    <div class="row mb-3">
      <div class="col-8">
        <h6>Pairing Controls</h6>
        <form action="/pairing/assign_judges/"
          method="post"
          onsubmit="return confirm('Do you really want to assign judges. All previous assignments will be lost.  If you are unsure, click cancel and back up')"> {% csrf_token %}
          <div class="btn-group btn-group-sm">
            {% if judges_assigned %}
            <button type="submit" class="mid btn btn-success" href="/pairing/assign_judges/" title="Assign judges to your pairing">Assign Judges Again</button>
            {% else %}
            <button type="submit" class="mid btn btn-warning" href="/pairing/assign_judges/" title="Assign judges to your pairing">Assign Judges</button>
            {% endif %}
            {% if pairing_released %}
            <a class="btn btn-success release" href="#"
                title="Release the pairings to the participants">Close Pairings</a>
            {% else %}
            <a class="btn btn-warning release" href="#"
                title="Release the pairings to the participants">Release Pairing</a>
            {% endif %}
            <a class="btn btn-info" href="{{ pair_round_url }}"
              title="Pair the next round of debate">Prepare Next Round</a>
          </div>
        </form>
      </div>

      <div class="col-4">
        <h6>Display Options</h6>
        <div class="btn-group btn-group-sm">
          <a class="btn btn-secondary" href="/pairings/pairinglist/" title="A randomized view to display in GA">Announcement View</a>
          <a class="btn btn-secondary" href="/pairings/pairinglist/printable" title="A randomized view to print for GA">Printable View</a>
        </div>
      </div>
    </div> <!-- end control row -->

    <div class="row">
      {% for pairing in round_info %}

      <div class="col-xl-6">
        <div class="card bg-light pairing-card mb-3">
          <div class="card-body container-fluid">
            <div class="row">

              <div class="col-5">
                <table class="table table-borderless table-sm mb-0">
                  <tr>
                    <td>
                      <h6>
                        <a href="/team/{{pairing.gov_team.id}}" class="text-dark">{{pairing.gov_team.name}}</a>
                        <small>
                          <abbr title="Gov Team" class="attribute">GOV</abbr>
                          <p class="text-muted team tabcard pt-1"
                             team-id={{pairing.gov_team.id}}>
                            Loading results...
                          </p>
                        </small>
                      </h6>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <h6>
                        <a href="/team/{{pairing.opp_team.id}}" class="text-dark">{{pairing.opp_team.name}}</a>
                        <small>
                          <abbr title="Opp Team" class="attribute">OPP</abbr>
                          <p class="text-muted team tabcard pt-1"
                             team-id={{pairing.opp_team.id}}>
                            Loading results...
                          </p>
                        </small>
                      </h6>
                    </td>
                  </tr>
                </table>
              </div>

              <div class="col-4">
                {% for judge in pairing.judges.all %}
                  <a class="btn-sm btn-link dropdown-toggle" data-toggle="dropdown"
                      round-id="{{pairing.id}}"
                      judge-id="{{judge.id}}" href="#">
                    {{judge.name}} <small>({{judge.rank}}) <span class="caret"></span></small>
                  </a>
                  <br/>
                {% endfor %}
                {% for slot in judge_slots %}
                {% if pairing.judges.all|length < slot %}
                  <a class="btn btn-link dropdown-toggle" data-toggle="dropdown"
                      round-id="{{pairing.id}}" judge-pos="{{slot}}" href="#">
                    <small>
                      N/A <span class="caret"></span>
                    </small>
                  </a>
                  <br/>
                {% endif %}
                {% endfor %}
              </div>

              <div class="col-3 text-center">
                {% if pairing.victor == 1 %}
                <a class="btn-sm btn-block btn-success" href="/round/{{pairing.id}}/result/">GOV win</a>
                {% elif pairing.victor == 2 %} 
                <a class="btn-sm btn-block btn-success" href="/round/{{pairing.id}}/result/">OPP win</a>
                {% elif pairing.victor == 3 %}
                <a class="btn-sm btn-block btn-success" href="/round/{{pairing.id}}/result/">GOV via Forfeit</a>
                {% elif pairing.victor == 4 %}
                <a class="btn-sm btn-block btn-success" href="/round/{{pairing.id}}/result/">OPP via Forfeit</a>
                {% elif pairing.victor == 5 %}
                <a class="btn-sm btn-block btn-success" href="/round/{{pairing.id}}/result/">All Drop</a>
                {% elif pairing.victor == 6 %}
                <a class="btn-sm btn-block btn-success" href="/round/{{pairing.id}}/result/">All Win</a>
                {% else %}
                <a class="btn-sm btn-block btn-warning" href="/round/{{pairing.id}}/result/">Enter Ballot</a>
                {%endif%}
                {% if pairing.judges.all|length > 1 %}
                <a class="btn-sm btn-block btn-warning" href="/round/{{pairing.id}}/result/{{pairing.judges.all|length}}/">Enter Panel</a>
                {% endif %}
                <a class="btn-sm btn-block btn-light" href="/room/{{pairing.room.id}}" >
                  <i class="far fa-building"></i> {{pairing.room.name}}
                </a>
                <a class="btn-sm btn-block btn-light"
                  href="/round/{{pairing.id}}/result/{{pairing.judges.all|length}}/">
                  <i class="fas fa-unlock-alt"></i> Edit in Admin
                </a>
              </div>
            </div>
           </div>
          </div>
        </div>

      {% endfor %}
    </div> <!-- end pairings row -->

    <div class="row">
      <div class="col not-paired-in overflow-auto">
        <h5>People Not Paired In</h5>
        <table class="table table-striped table-sm">
          <thead>
            <th>Checked in Teams ({{ byes|length }})</th>
            <th>Checked in Judges ({{ excluded_judges|length }})</th>
            <th>Non Checked in Judges ({{ non_checkins|length }})</th>
            <th>Available Rooms ({{ available_rooms|length }})</th>
          </thead>
          {% for team, cjudge, judge, room in excluded_people %}
          <tr>
            <td>
              {% if team %} <a href="/team/{{team.id}}" >{{team.name}}</a> {% endif %}
            </td>
            <td>
              {% if cjudge %} <a href="/judge/{{cjudge.id}}" >{{cjudge.name}}</a> {% endif %}
            </td>
            <td>
              {% if judge %} <a style="color:{% if judge.rank > warning %}red{%else%}black{%endif%}"href="/judge/{{judge.id}}" >{{judge.name}}</a> {% endif %}
            </td>
            <td>
              {% if room %} <a href="/room/{{room.id}}" >{{room.name}}</a> {% endif %}
            </td>
          </tr>
          {% endfor %}
        </table>
      </div>
    </div><!-- end not-paired-in row -->

  </div>
</div>

<div id="round_info">
        <div class="scroll">
        </div>
        <br>
    </div>
</div>
{% endblock %}
